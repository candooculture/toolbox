<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>Profit Potential – Now vs Fixed vs Risk-Free</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- Reuse the existing site styles if you want -->
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="clarity-style.css">
    <style>
        :root {
            --maxw: 980px;
            --pad: 16px;
            --gap: 12px;
            --radius: 12px;
        }

        body {
            font-family: "DM Sans", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
            margin: 0;
            padding: 24px;
            color: #0b0c10;
            background: #f9fafb;
        }

        .wrap {
            max-width: var(--maxw);
            margin: 0 auto;
        }

        h1,
        h2,
        h3 {
            margin: 0 0 12px;
        }

        p {
            margin: 0 0 8px;
            opacity: 0.85;
        }

        .card {
            background: #fff;
            border: 1px solid #e5e7eb;
            border-radius: var(--radius);
            padding: 18px;
            margin-bottom: 16px;
            box-shadow: 0 1px 2px rgba(0, 0, 0, .03);
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            gap: var(--gap);
        }

        .col-6 {
            grid-column: span 6;
        }

        .col-4 {
            grid-column: span 4;
        }

        .col-3 {
            grid-column: span 3;
        }

        .col-12 {
            grid-column: span 12;
        }

        label {
            display: block;
            font-size: 0.95rem;
            margin-bottom: 6px;
        }

        input[type="number"] {
            width: 100%;
            box-sizing: border-box;
            padding: 10px 12px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 1rem;
            background: #fff;
        }

        input[type="checkbox"] {
            transform: translateY(2px);
            margin-right: 8px;
        }

        .hint {
            font-size: 0.85rem;
            opacity: .7;
        }

        .actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 8px;
        }

        button {
            appearance: none;
            border: 1px solid #0ea5e9;
            background: #0ea5e9;
            color: #fff;
            padding: 10px 14px;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
        }

        button.ghost {
            background: #fff;
            color: #0ea5e9;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 8px;
            border: 1px solid #e5e7eb;
            border-radius: var(--radius);
            overflow: hidden;
            background: #fff;
        }

        th,
        td {
            text-align: right;
            padding: 10px 12px;
            border-bottom: 1px solid #f0f1f3;
            font-variant-numeric: tabular-nums;
        }

        th:first-child,
        td:first-child {
            text-align: left;
        }

        thead th {
            background: #f7fafc;
            font-weight: 700;
        }

        tfoot td {
            font-weight: 700;
            background: #fbfdff;
        }

        .pos {
            color: #059669;
        }

        .neg {
            color: #b91c1c;
        }

        .logo {
            position: relative;
            margin-bottom: 10px;
        }

        .logo a {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            text-decoration: none;
            color: inherit;
        }

        .logo-tag {
            font-size: .9rem;
            opacity: .8;
            text-decoration: underline;
        }

        @media (max-width: 860px) {

            .col-6,
            .col-4,
            .col-3,
            .col-12 {
                grid-column: span 12;
            }
        }
    </style>
</head>

<body>
    <div class="wrap">
        <div class="logo">
            <a href="https://candooculture.com/">
                <img src="candoologo.png" alt="Candoo Logo" style="width:48px;height:auto;opacity:.9">
                <span class="logo-tag">Return Home</span>
            </a>
        </div>

        <h1>Profit Potential</h1>
        <p class="hint">Compare today’s profit to what it could be if you fix inefficiencies and/or eliminate risk
            (ORS).</p>

        <!-- ===== Inputs: Current Financials ===== -->
        <div class="card">
            <h2>Current Financials</h2>
            <p class="hint">Enter what you know. If you only know Net Profit, you can put it below and leave
                Revenue/COGS/Opex blank.</p>
            <div class="grid" style="margin-top:8px;">
                <div class="col-4">
                    <label for="revenue">Revenue (period)</label>
                    <input type="number" id="revenue" step="0.01" placeholder="e.g. 5,000,000">
                </div>
                <div class="col-4">
                    <label for="cogs">COGS</label>
                    <input type="number" id="cogs" step="0.01" placeholder="e.g. 2,500,000">
                </div>
                <div class="col-4">
                    <label for="opex">Operating Expenses (excl COGS)</label>
                    <input type="number" id="opex" step="0.01" placeholder="e.g. 1,900,000">
                </div>
                <div class="col-4">
                    <label for="grossNow">Gross Profit (auto)</label>
                    <input type="number" id="grossNow" step="0.01" disabled>
                </div>
                <div class="col-4">
                    <label for="netNow">Net Profit (auto if above filled, else enter)</label>
                    <input type="number" id="netNow" step="0.01" placeholder="e.g. 600,000">
                </div>
                <div class="col-4">
                    <label for="periodLabel">Period Label</label>
                    <input type="text" id="periodLabel" placeholder="e.g. FY25, Q3, Project X">
                </div>
            </div>
        </div>

        <!-- ===== Inputs: Savings & ORS ===== -->
        <div class="card">
            <h2>Fixable Savings & ORS Impact</h2>
            <p class="hint">If your calculators already produced $-savings, they may auto-fill. Otherwise, type them.
            </p>
            <div class="grid" style="margin-top:8px;">
                <div class="col-4">
                    <label for="payrollSavings">Payroll Waste – Savings</label>
                    <input type="number" id="payrollSavings" step="0.01" placeholder="e.g. 120,000">
                </div>
                <div class="col-4">
                    <label for="churnSavings">Customer Churn – Recovery</label>
                    <input type="number" id="churnSavings" step="0.01" placeholder="e.g. 250,000">
                </div>
                <div class="col-4">
                    <label for="workforceSavings">Workforce Productivity – Gain</label>
                    <input type="number" id="workforceSavings" step="0.01" placeholder="e.g. 300,000">
                </div>
                <div class="col-4">
                    <label for="deepDiveSavings">Productivity Deep Dive – Gain</label>
                    <input type="number" id="deepDiveSavings" step="0.01" placeholder="e.g. 90,000">
                </div>
                <div class="col-4">
                    <label for="leadershipSavings">Leadership Drag – Reduction</label>
                    <input type="number" id="leadershipSavings" step="0.01" placeholder="e.g. 160,000">
                </div>
                <div class="col-4">
                    <label for="orsRisk">ORS – EBITDA at Risk</label>
                    <input type="number" id="orsRisk" step="0.01" placeholder="e.g. 800,000">
                    <p class="hint">Auto-reads common keys. Edit if needed.</p>
                </div>
            </div>

            <div class="actions">
                <label><input type="checkbox" id="applyFixes" checked>Apply “Fix Inefficiencies”</label>
                <label><input type="checkbox" id="applyORS" checked>Eliminate ORS Risk</label>
                <button id="recalc">Recalculate</button>
                <button id="clear" class="ghost">Reset This Page</button>
            </div>
        </div>

        <!-- ===== Output: Summary Table ===== -->
        <div class="card">
            <h2>Profit Comparison</h2>
            <table id="resultsTable" aria-describedby="summary">
                <thead>
                    <tr>
                        <th>Scenario</th>
                        <th>Gross Profit</th>
                        <th>Net Profit</th>
                        <th>Δ vs Now</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Now</td>
                        <td id="gpNowCell">–</td>
                        <td id="npNowCell">–</td>
                        <td>–</td>
                    </tr>
                    <tr>
                        <td>Fix Inefficiencies</td>
                        <td id="gpFixCell">–</td>
                        <td id="npFixCell">–</td>
                        <td id="npFixDelta">–</td>
                    </tr>
                    <tr>
                        <td>Eliminate ORS Risk</td>
                        <td id="gpORSCell">–</td>
                        <td id="npORSCell">–</td>
                        <td id="npORSDelta">–</td>
                    </tr>
                </tbody>
                <tfoot>
                    <tr>
                        <td>Fix + ORS Eliminated</td>
                        <td id="gpBestCell">–</td>
                        <td id="npBestCell">–</td>
                        <td id="npBestDelta">–</td>
                    </tr>
                </tfoot>
            </table>
            <p id="summary" class="hint" style="margin-top:8px;"></p>
        </div>

        <!-- ===== Utility ===== -->
        <div class="card">
            <h3>Export Snapshot</h3>
            <div class="actions">
                <button id="copyJSON" class="ghost">Copy JSON</button>
            </div>
            <p class="hint">Copies inputs + results so you can paste into notes or email.</p>
        </div>
    </div>

    <script>
        // ---- Storage Keys (soft conventions; we try multiple) ----
        const KEYMAP = {
            ors: ["ors_ebitda_at_risk", "ors-ebitda-risk", "orsTotalRisk", "ORS_EBITDA_AT_RISK"],
            savings: {
                payroll: ["payroll-waste-savings", "payrollSavings", "payroll_waste_savings"],
                churn: ["customer-churn-savings", "churnSavings", "customer_churn_savings"],
                workforce: ["workforce-productivity-savings", "workforceSavings", "workforce_productivity_savings"],
                deep: ["productivity-deep-dive-savings", "deepDiveSavings", "productivity_deep_dive_savings"],
                leadership: ["leadership-drag-savings", "leadershipSavings", "leadership_drag_savings"]
            }
        };

        // Try a list of keys, return first numeric value found
        function lsFirstNumber(keys) {
            for (const k of keys) {
                const raw = localStorage.getItem(k);
                if (!raw) continue;
                const v = Number(String(raw).replace(/,/g, "").trim());
                if (!Number.isNaN(v)) return v;
                try {
                    const obj = JSON.parse(raw);
                    // Look for common fields if an object
                    const candidates = ["value", "amount", "total", "ebitda_at_risk", "ebitdaRisk", "risk", "savings", "gain"];
                    for (const c of candidates) {
                        if (obj && typeof obj === "object" && obj[c] != null) {
                            const n = Number(String(obj[c]).replace(/,/g, ""));
                            if (!Number.isNaN(n)) return n;
                        }
                    }
                } catch (_) { }
            }
            return null;
        }

        // Format currency
        function fmt(n) {
            if (n == null || Number.isNaN(n)) return "–";
            return n.toLocaleString(undefined, { style: "currency", currency: "AUD", maximumFractionDigits: 0 });
        }

        // Read input values (numbers) with forgiving parsing
        function num(id) {
            const el = document.getElementById(id);
            if (!el) return 0;
            const v = Number(String(el.value).replace(/,/g, "").trim());
            return Number.isFinite(v) ? v : 0;
        }

        function setVal(id, value) {
            const el = document.getElementById(id);
            if (!el) return;
            el.value = value ?? "";
            localStorage.setItem(id, el.value);
        }

        // Compute “Now” GP & NP
        function computeNow() {
            const rev = num("revenue");
            const cogs = num("cogs");
            const opex = num("opex");
            let gp = null, np = null;

            if (rev || cogs || opex) {
                gp = (rev || 0) - (cogs || 0);
                np = gp - (opex || 0);
                setVal("grossNow", String(gp));
                if (!num("netNow")) setVal("netNow", String(np));
            } else {
                // If only netNow given, we accept it and leave gp blank
                gp = num("grossNow") || null;
                np = num("netNow") || 0;
            }
            return { gpNow: gp, npNow: np };
        }

        function totalSavings() {
            return num("payrollSavings") + num("churnSavings") + num("workforceSavings") + num("deepDiveSavings") + num("leadershipSavings");
        }

        // Recalculate scenarios
        function recalc() {
            const { gpNow, npNow } = computeNow();
            const fixes = totalSavings();
            const ors = num("orsRisk");
            const useFixes = document.getElementById("applyFixes").checked;
            const useORS = document.getElementById("applyORS").checked;

            // Base
            document.getElementById("gpNowCell").textContent = fmt(gpNow);
            document.getElementById("npNowCell").textContent = fmt(npNow);

            // Fixes only
            const npFix = npNow + (useFixes ? fixes : 0);
            document.getElementById("gpFixCell").textContent = fmt(gpNow); // GP unchanged by opex fixes (keep simple)
            document.getElementById("npFixCell").textContent = fmt(npFix);
            document.getElementById("npFixDelta").innerHTML = deltaBadge(npFix - npNow);

            // ORS only
            const npORS = npNow + (useORS ? ors : 0);
            document.getElementById("gpORSCell").textContent = fmt(gpNow);
            document.getElementById("npORSCell").textContent = fmt(npORS);
            document.getElementById("npORSDelta").innerHTML = deltaBadge(npORS - npNow);

            // Best case
            const npBest = npNow + (useFixes ? fixes : 0) + (useORS ? ors : 0);
            document.getElementById("gpBestCell").textContent = fmt(gpNow);
            document.getElementById("npBestCell").textContent = fmt(npBest);
            document.getElementById("npBestDelta").innerHTML = deltaBadge(npBest - npNow);

            // Summary
            const period = (document.getElementById("periodLabel").value || "this period");
            document.getElementById("summary").textContent =
                `In ${period}, fixing inefficiencies adds ${fmt(useFixes ? fixes : 0)}, eliminating ORS adds ${fmt(useORS ? ors : 0)}. Best-case Net Profit becomes ${fmt(npBest)} (from ${fmt(npNow)}).`;
        }

        function deltaBadge(delta) {
            if (!Number.isFinite(delta)) return "–";
            const cls = delta >= 0 ? "pos" : "neg";
            const sign = delta >= 0 ? "+" : "";
            return `<span class="${cls}">${sign}${fmt(delta)}</span>`;
        }

        // Load from localStorage (our page keys + common cross-module keys)
        function preload() {
            // Restore our page fields
            const ids = ["revenue", "cogs", "opex", "grossNow", "netNow", "periodLabel",
                "payrollSavings", "churnSavings", "workforceSavings", "deepDiveSavings", "leadershipSavings", "orsRisk",
                "applyFixes", "applyORS"];
            for (const id of ids) {
                const el = document.getElementById(id);
                if (!el) continue;
                const stored = localStorage.getItem(id);
                if (stored != null) {
                    if (el.type === "checkbox") el.checked = stored === "true";
                    else el.value = stored;
                }
                // Persist on change
                el.addEventListener(el.type === "checkbox" ? "change" : "input", () => {
                    localStorage.setItem(id, el.type === "checkbox" ? String(el.checked) : el.value);
                });
            }

            // Attempt to auto-read savings and ORS from common keys if empty
            if (!num("payrollSavings")) {
                const v = lsFirstNumber(KEYMAP.savings.payroll);
                if (v != null) setVal("payrollSavings", v);
            }
            if (!num("churnSavings")) {
                const v = lsFirstNumber(KEYMAP.savings.churn);
                if (v != null) setVal("churnSavings", v);
            }
            if (!num("workforceSavings")) {
                const v = lsFirstNumber(KEYMAP.savings.workforce);
                if (v != null) setVal("workforceSavings", v);
            }
            if (!num("deepDiveSavings")) {
                const v = lsFirstNumber(KEYMAP.savings.deep);
                if (v != null) setVal("deepDiveSavings", v);
            }
            if (!num("leadershipSavings")) {
                const v = lsFirstNumber(KEYMAP.savings.leadership);
                if (v != null) setVal("leadershipSavings", v);
            }
            if (!num("orsRisk")) {
                const v = lsFirstNumber(KEYMAP.ors);
                if (v != null) setVal("orsRisk", v);
            }
        }

        // Export JSON
        function copyJSON() {
            const payload = {
                period: document.getElementById("periodLabel").value || null,
                inputs: {
                    revenue: num("revenue"),
                    cogs: num("cogs"),
                    opex: num("opex"),
                    grossNow: num("grossNow") || null,
                    netNow: num("netNow"),
                },
                savings: {
                    payroll: num("payrollSavings"),
                    churn: num("churnSavings"),
                    workforce: num("workforceSavings"),
                    deepDive: num("deepDiveSavings"),
                    leadership: num("leadershipSavings"),
                },
                ors: { ebitdaAtRisk: num("orsRisk") },
                scenarios: {
                    applyFixes: document.getElementById("applyFixes").checked,
                    applyORS: document.getElementById("applyORS").checked
                },
                results: {
                    now: {
                        gross: document.getElementById("gpNowCell").textContent,
                        net: document.getElementById("npNowCell").textContent
                    },
                    fixes: {
                        gross: document.getElementById("gpFixCell").textContent,
                        net: document.getElementById("npFixCell").textContent,
                        delta: document.getElementById("npFixDelta").innerText
                    },
                    orsOnly: {
                        gross: document.getElementById("gpORSCell").textContent,
                        net: document.getElementById("npORSCell").textContent,
                        delta: document.getElementById("npORSDelta").innerText
                    },
                    best: {
                        gross: document.getElementById("gpBestCell").textContent,
                        net: document.getElementById("npBestCell").textContent,
                        delta: document.getElementById("npBestDelta").innerText
                    }
                }
            };
            const text = JSON.stringify(payload, null, 2);
            navigator.clipboard.writeText(text).then(() => {
                alert("Copied results JSON to clipboard.");
            }, () => {
                // Fallback
                const ta = document.createElement("textarea");
                ta.value = text;
                document.body.appendChild(ta);
                ta.select();
                document.execCommand("copy");
                document.body.removeChild(ta);
                alert("Copied results JSON to clipboard.");
            });
        }

        // Reset just this page’s fields
        function clearPage() {
            const ids = ["revenue", "cogs", "opex", "grossNow", "netNow", "periodLabel",
                "payrollSavings", "churnSavings", "workforceSavings", "deepDiveSavings", "leadershipSavings", "orsRisk",
                "applyFixes", "applyORS"];
            for (const id of ids) {
                localStorage.removeItem(id);
                const el = document.getElementById(id);
                if (!el) continue;
                if (el.type === "checkbox") el.checked = (id === "applyFixes" || id === "applyORS"); // default checked
                else el.value = "";
            }
            recalc();
        }

        // Wire up
        window.addEventListener("DOMContentLoaded", () => {
            preload();
            // Live recompute on key inputs
            ["revenue", "cogs", "opex", "netNow", "payrollSavings", "churnSavings", "workforceSavings", "deepDiveSavings", "leadershipSavings", "orsRisk", "applyFixes", "applyORS", "periodLabel"]
                .forEach(id => {
                    const el = document.getElementById(id);
                    if (!el) return;
                    el.addEventListener(el.type === "checkbox" ? "change" : "input", recalc);
                });

            document.getElementById("recalc").addEventListener("click", recalc);
            document.getElementById("copyJSON").addEventListener("click", copyJSON);
            document.getElementById("clear").addEventListener("click", clearPage);

            recalc();
        });
    </script>
</body>

</html>