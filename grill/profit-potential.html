<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Profit Potential – Now vs Fixed vs Risk-Free</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="clarity-style.css">
  <style>
  /* Profit Potential — fully scoped, dark, Montserrat (compact) */
  .profit{
    --maxw: 980px;
    --pad: 12px;      /* was 16 */
    --gap: 10px;      /* was 12 */
    --radius: 10px;   /* was 12 */
    font-family:'Montserrat', sans-serif;
    color:#fff;
  }
  .profit .wrap{ max-width:var(--maxw); margin:0 auto; padding:0 var(--pad); }

  .profit h1,.profit h2,.profit h3{ margin:0 0 8px; }   /* was 12 */
  .profit p{ margin:0 0 6px; opacity:.85; }             /* was 8 */

  .profit .card{
    background:rgba(15,15,15,.85);
    border:1px solid #333;
    border-radius:var(--radius);
    padding:14px;               /* was 18 */
    margin-bottom:12px;         /* was 16 */
    box-shadow:0 1px 6px rgba(0,0,0,.5);
  }

  .profit .grid{ display:grid; grid-template-columns:repeat(12,1fr); gap:var(--gap); }
  .profit .col-6{ grid-column:span 6; }
  .profit .col-4{ grid-column:span 4; }
  .profit .col-3{ grid-column:span 3; }
  .profit .col-12{ grid-column:span 12; }
  @media (max-width:860px){
    .profit .col-6, .profit .col-4, .profit .col-3, .profit .col-12{ grid-column:span 12; }
  }

  .profit label{
    display:block;
    font-size:.92rem;           /* was .95rem */
    margin-bottom:4px;          /* was 6px */
    color:#bfc7cc;              /* slightly lighter */
  }

  .profit input[type="number"],
  .profit input[type="text"],
  .profit input[type="email"]{
    width:100%;
    box-sizing:border-box;
    padding:8px 10px;           /* was 10–12 */
    height:44px;                /* consistent compact height */
    background:#0f0f0f;
    border:1px solid #333;
    border-radius:8px;
    color:#fff;
    font-size:.95rem;           /* was 1rem */
    line-height:1.2;
  }

  /* hide number spinners to save space */
  .profit input[type="number"]::-webkit-outer-spin-button,
  .profit input[type="number"]::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
  .profit input[type="number"] { -moz-appearance: textfield; }

  .profit input[type="checkbox"]{ transform:translateY(1px); margin-right:8px; }

  .profit .hint{ font-size:.82rem; opacity:.72; }        /* was .85/.7 */

  .profit .actions{
    display:flex;
    gap:8px;                     /* was 10 */
    flex-wrap:wrap;
    margin-top:6px;              /* was 8 */
  }
  .profit button{
    background:#13dcff; color:#000; font-weight:600;
    padding:9px 12px;            /* was 10x14 */
    border:none; border-radius:9px; cursor:pointer;
  }
  .profit button.ghost{ background:transparent; border:1px solid #333; color:#fff; }

  .profit table{
    width:100%;
    border-collapse:collapse;
    margin-top:6px;              /* was 8 */
    border:1px solid #333;
    border-radius:var(--radius);
    overflow:hidden;
    background:#0b0b0b;
    color:#eee;
  }
  .profit thead th{
    text-align:left;
    font-weight:600;
    padding:10px;                /* was 12 */
    background:#0f0f0f;
    border-bottom:1px solid #333;
  }
  .profit tbody td{
    padding:10px;                /* was 12 */
    border-bottom:1px solid #222;
    text-align:right;
    font-variant-numeric:tabular-nums;
  }
  .profit tbody td:first-child, .profit thead th:first-child{ text-align:left; }
  .profit tfoot td{ font-weight:700; background:#101010; }

  .profit .pos{ color:#13dcff; }
  .profit .neg{ color:#ff6b6b; }

  /* Hide duplicate module logo (index already shows brand) */
  .profit .logo{ display:none; }
</style>
</head>
<body>
  <div class="profit dense">
    <div class="wrap">
      <div class="logo">
        <a href="https://candooculture.com/">
          <img src="candoologo.png" alt="Candoo Logo" style="width:48px;height:auto;opacity:.9">
          <span class="logo-tag">Return Home</span>
        </a>
      </div>

      <h1>Profit Potential</h1>

      <!-- ===== Inputs: Current Financials ===== -->
      <div class="card">
        <h2>Current Financials</h2>
        <p class="hint">Enter what you know. If you only know Net Profit, you can put it below and leave Revenue/COGS/OpEx blank.</p>
        <div class="grid" style="margin-top:8px;">
          <div class="col-4">
            <label for="revenue">Revenue (period)</label>
            <input type="number" id="revenue" step="0.01" placeholder="e.g. 5,000,000">
          </div>
          <div class="col-4">
            <label for="cogs">COGS</label>
            <input type="number" id="cogs" step="0.01" placeholder="e.g. 2,500,000">
          </div>
          <div class="col-4">
            <label for="opex">Operating Expenses (excl COGS)</label>
            <input type="number" id="opex" step="0.01" placeholder="e.g. 1,900,000">
          </div>
          <div class="col-4">
            <label for="grossNow">Gross Profit (auto)</label>
            <input type="number" id="grossNow" step="0.01" disabled>
          </div>
          <div class="col-4">
            <label for="netNow">Net Profit (auto)</label>
            <input type="number" id="netNow" step="0.01" placeholder="e.g. 600,000">
          </div>
          <div class="col-4">
            <label for="periodLabel">Period Label</label>
            <input type="text" id="periodLabel" placeholder="e.g. FY25, Q3, Project X">
          </div>
        </div>
      </div>

      <!-- ===== Inputs: Fixable Savings ===== -->
<div class="card">
  <h2>Fixable Savings - auto complete from Toolbox</h2>
  <div class="grid" style="margin-top:8px;">
    <div class="col-4">
      <label for="payrollSavings">Payroll Waste – Savings</label>
      <input type="number" id="payrollSavings" step="0.01" placeholder="e.g. 120,000">
    </div>
    <div class="col-4">
      <label for="churnSavings">Customer Churn – Recovery</label>
      <input type="number" id="churnSavings" step="0.01" placeholder="e.g. 250,000">
    </div>
    <div class="col-4">
      <label for="leadershipSavings">Leadership Drag – Reduction</label>
      <input type="number" id="leadershipSavings" step="0.01" placeholder="e.g. 160,000">
    </div>
    <div class="col-4">
      <label for="workforceSavings">Workforce Productivity – Gain</label>
      <input type="number" id="workforceSavings" step="0.01" placeholder="e.g. 300,000">
    </div>
    <div class="col-4">
      <label for="deepDiveSavings">Productivity Deep Dive – Gain</label>
      <input type="number" id="deepDiveSavings" step="0.01" placeholder="e.g. 90,000">
    </div>
    <div class="col-4" style="display:flex; flex-direction:column; align-items:flex-end; justify-content:flex-end;">
      <label for="applyFixes">Fix Inefficiencies</label>
      <input type="checkbox" id="applyFixes" class="big-checkbox">
    </div>
  </div>

  <div class="actions" style="justify-content:flex-end;">
    <button id="recalcFix" class="btn-recalc">Recalculate</button>
  </div>
</div>

<!-- ===== Output: Fix Savings Comparison ===== -->
<div class="card">
  <h2>Profit Comparison – Fixable Savings</h2>
  <table id="resultsFixTable">
    <thead>
      <tr>
        <th>Scenario</th>
        <th>Gross Profit</th>
        <th>Net Profit</th>
        <th>Δ vs Now</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Now</td>
        <td id="gpNowCell">–</td>
        <td id="npNowCell">–</td>
        <td>–</td>
      </tr>
      <tr>
        <td>Fix Inefficiencies</td>
        <td id="gpFixCell">–</td>
        <td id="npFixCell">–</td>
        <td id="npFixDelta">–</td>
      </tr>
    </tbody>
  </table>
</div>

<!-- ===== Inputs: ORS Risk ===== -->
<div class="card">
  <h2>Operational Risk</h2>
  <p class="hint">Looking to sell? EBITDA strength + RISK exposure directly shape what your business is worth.</p>
  <div class="grid" style="margin-top:8px;">
    <div class="col-4">
      <label for="orsRisk">ORS – EBITDA at Risk</label>
      <input type="number" id="orsRisk" step="0.01" placeholder="e.g. 800,000">
    </div>
    <div class="col-4" style="display:flex; flex-direction:column; align-items:flex-end; justify-content:flex-end;">
      <label for="applyORS">Eliminate Op Risk</label>
      <input type="checkbox" id="applyORS" class="big-checkbox">
    </div>
  </div>

  <div class="actions" style="justify-content:flex-end;">
    <button id="recalcORS" class="btn-recalc">Recalculate</button>
  </div>
</div>

<!-- ===== Output: ORS Risk Comparison ===== -->
<div class="card">
  <h2>Profit Comparison – ORS Risk</h2>
  <table id="resultsORSTable">
    <thead>
      <tr>
        <th>Scenario</th>
        <th>Gross Profit</th>
        <th>Net Profit</th>
        <th>Δ vs Now</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Now</td>
        <td id="gpNowORS">–</td>
        <td id="npNowORS">–</td>
        <td>–</td>
      </tr>
      <tr>
        <td>Eliminate ORS Risk</td>
        <td id="gpORSCell">–</td>
        <td id="npORSCell">–</td>
        <td id="npORSDelta">–</td>
      </tr>
    </tbody>
  </table>
</div>

      <!-- ===== Styling for checkboxes and button ===== -->
<style>
  .btn-recalc {
    background:#c55c5c;
    color:#fff;
    font-weight:600;
    padding:9px 12px;
    border:none;
    border-radius:9px;
    cursor:pointer;
  }
  .btn-recalc:hover {
    filter:brightness(.95);
  }
  .big-checkbox {
    width: 22px;
    height: 22px;
    transform: translateY(4px);
    cursor:pointer;
  }
</style>
      
<!-- ===== Styling for muted red button ===== -->
<style>
  .btn-recalc {
    background:#c55c5c;
    color:#fff;
    font-weight:600;
    padding:9px 12px;
    border:none;
    border-radius:9px;
    cursor:pointer;
  }
  .btn-recalc:hover {
    filter:brightness(.95);
  }
</style>

      <!-- ===== Email Report ===== -->
<div class="card">
  <h2>Email Report</h2>
  <div class="grid" style="margin-top:8px;">
    <div class="col-6">
      <label for="reportEmail">Send to</label>
      <input type="email" id="reportEmail" placeholder="e.g. name@company.com">
    </div>
    <div class="col-6" style="display:flex; align-items:flex-end; justify-content:flex-end;">
      <button id="sendReport" class="btn-send">Send Report</button>
    </div>
  </div>
  <p class="hint">Uses your saved email from ORS if available. You’ll receive a formatted summary of this page.</p>
</div>

<style>
  .btn-send{
    background:#13dcff;
    color:#000;
    font-weight:600;
    padding:9px 12px;
    border:none; border-radius:9px; cursor:pointer;
  }
  .btn-send:hover{ filter:brightness(.95); }
</style>

<script>
  // --- Build the same payload your Copy JSON used, but for email ---
  function buildProfitReportPayload(){
    const payload = {
      period: document.getElementById("periodLabel")?.value || null,
      inputs: {
        revenue: Number(String(document.getElementById("revenue")?.value||"").replace(/,/g,""))||0,
        cogs: Number(String(document.getElementById("cogs")?.value||"").replace(/,/g,""))||0,
        opex: Number(String(document.getElementById("opex")?.value||"").replace(/,/g,""))||0,
        grossNow: Number(String(document.getElementById("grossNow")?.value||"").replace(/,/g,""))||null,
        netNow: Number(String(document.getElementById("netNow")?.value||"").replace(/,/g,""))||0
      },
      savings: {
        payroll: Number(String(document.getElementById("payrollSavings")?.value||"").replace(/,/g,""))||0,
        churn: Number(String(document.getElementById("churnSavings")?.value||"").replace(/,/g,""))||0,
        workforce: Number(String(document.getElementById("workforceSavings")?.value||"").replace(/,/g,""))||0,
        deepDive: Number(String(document.getElementById("deepDiveSavings")?.value||"").replace(/,/g,""))||0,
        leadership: Number(String(document.getElementById("leadershipSavings")?.value||"").replace(/,/g,""))||0
      },
      ors: {
        ebitdaAtRisk: Number(String(document.getElementById("orsRisk")?.value||"").replace(/,/g,""))||0
      },
      scenarios: {
        applyFixes: !!document.getElementById("applyFixes")?.checked,
        applyORS: !!document.getElementById("applyORS")?.checked
      },
      // current on-screen results (uses your existing cell IDs)
      results: {
        now:   { gross: document.getElementById("gpNowCell")?.textContent || "–",
                 net:   document.getElementById("npNowCell")?.textContent || "–" },
        fixes: { gross: document.getElementById("gpFixCell")?.textContent || "–",
                 net:   document.getElementById("npFixCell")?.textContent || "–",
                 delta: document.getElementById("npFixDelta")?.innerText || "–" },
        orsOnly:{gross: document.getElementById("gpORSCell")?.textContent || "–",
                 net:   document.getElementById("npORSCell")?.textContent || "–",
                 delta: document.getElementById("npORSDelta")?.innerText || "–" },
        best:  { gross: document.getElementById("gpBestCell")?.textContent || "–",
                 net:   document.getElementById("npBestCell")?.textContent || "–",
                 delta: document.getElementById("npBestDelta")?.innerText || "–" }
      }
    };
    return payload;
  }

  // --- Prefill email from localStorage and persist edits ---
  (function initEmailField(){
    const emailEl = document.getElementById("reportEmail");
    if (!emailEl) return;

    const emailKeys = ["candoo-user-email", "reportEmail", "userEmail", "email"];
    for (const k of emailKeys){
      const v = localStorage.getItem(k);
      if (v && !emailEl.value) { emailEl.value = v; break; }
    }
    emailEl.addEventListener("input", ()=> {
      localStorage.setItem("reportEmail", emailEl.value.trim());
      // keep your global key in sync if present
      localStorage.setItem("candoo-user-email", emailEl.value.trim());
    });
  })();

  // --- Frontend-only: package and dispatch a custom event the backend can hook later ---
  document.getElementById("sendReport")?.addEventListener("click", ()=>{
    const email = document.getElementById("reportEmail")?.value.trim();
    if (!email || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)){
      alert("Please enter a valid email.");
      return;
    }
    const payload = buildProfitReportPayload();
    // persist the latest email for other modules
    localStorage.setItem("candoo-user-email", email);

    // emit a custom event with the data. Backend wiring can listen or this can be swapped for fetch().
    const evt = new CustomEvent("profit-report:send", { detail: { email, payload }});
    window.dispatchEvent(evt);

    alert("Report queued to send. (Frontend ready — backend wiring next.)");
  });
  </script>
<script>
  
  // ---- Storage Keys (soft conventions; we try multiple) ----
  const KEYMAP = {
    ors: ["ors_ebitda_at_risk", "ors-ebitda-risk", "orsTotalRisk", "ORS_EBITDA_AT_RISK"],
    savings: {
      payroll: ["payroll-waste-savings", "payrollSavings", "payroll_waste_savings"],
      churn: ["customer-churn-savings", "churnSavings", "customer_churn_savings"],
      workforce: ["workforce-productivity-savings", "workforceSavings", "workforce_productivity_savings"],
      deep: ["productivity-deep-dive-savings", "deepDiveSavings", "productivity_deep_dive_savings"],
      leadership: ["leadership-drag-savings", "leadershipSavings", "leadership_drag_savings"]
    }
  };

  // Track whether user has manually edited Net Profit
  let netNowTouched = false;

  // ---------- helpers ----------
  function lsFirstNumber(keys){
    for (const k of keys){
      const raw = localStorage.getItem(k);
      if (!raw) continue;
      const v = Number(String(raw).replace(/,/g,"").trim());
      if (!Number.isNaN(v)) return v;
      try{
        const obj = JSON.parse(raw);
        const candidates = ["value","amount","total","ebitda_at_risk","ebitdaRisk","risk","savings","gain"];
        for (const c of candidates){
          if (obj && typeof obj==="object" && obj[c]!=null){
            const n = Number(String(obj[c]).replace(/,/g,""));
            if (!Number.isNaN(n)) return n;
          }
        }
      }catch(_){}
    }
    return null;
  }

  function fmt(n){
    if (n==null || Number.isNaN(n)) return "–";
    return n.toLocaleString(undefined,{style:"currency",currency:"AUD",maximumFractionDigits:0});
  }

  function num(id){
    const el = document.getElementById(id);
    if (!el) return 0;
    const v = Number(String(el.value).replace(/,/g,"").trim());
    return Number.isFinite(v)? v:0;
  }

  function setVal(id,value){
    const el = document.getElementById(id);
    if (!el) return;
    el.value = value ?? "";
    localStorage.setItem(id, el.value);
  }

  // ---------- snapshot preload ----------
  function readSnapshotFromLocal(){
    const keys = ["ors_last_snapshot","ors_snapshot"];
    for (const k of keys){
      const raw = localStorage.getItem(k);
      if (!raw) continue;
      try{
        const s = JSON.parse(raw);
        if (s && (s.inputs || s.savings || s.risk)) return s;
      }catch(_){}
    }
    return null;
  }

  function applySnapshotToInputs(s){
    let changed = 0;
    const put = (id, val) => {
      if (val==null) return;
      const el = document.getElementById(id);
      if (!el) return;
      if (String(el.value).trim() !== "") return; // don't overwrite user input
      setVal(id, String(val));
      changed++;
    };

    if (s.inputs){
      put("revenue",   s.inputs.revenue);
      put("cogs",      s.inputs.cogs);
      put("opex",      s.inputs.opex);
      put("grossNow",  s.inputs.gross_now);
      put("netNow",    s.inputs.net_now);
    }
    if (s.savings){
      put("payrollSavings",   s.savings.payroll_savings);
      put("churnSavings",     s.savings.churn_recovery);
      put("workforceSavings", s.savings.workforce_gain);
      put("deepDiveSavings",  s.savings.deep_dive_gain);
      put("leadershipSavings",s.savings.leadership_reduction);
    }
    if (s.risk){
      put("orsRisk", s.risk.ors_ebitda_at_risk);
    }
    return changed>0;
  }

  // ---------- calcs ----------
  function computeNow(){
    const rev  = num("revenue");
    const cogs = num("cogs");
    const opex = num("opex");

    let gp=null, np=null;

    if (rev || cogs || opex){
      gp = (rev || 0) - (cogs || 0);
      np = gp - (opex || 0);

      setVal("grossNow", String(gp));

      // Only auto-fill Net Profit if user hasn't typed in it this session
      if (!netNowTouched) {
        setVal("netNow", String(np));
      }
    } else {
      gp = num("grossNow") || null;
      np = num("netNow")  || 0;
    }
    return { gpNow: gp, npNow: np };
  }

  function totalSavings(){
    return num("payrollSavings")+num("churnSavings")+num("workforceSavings")+num("deepDiveSavings")+num("leadershipSavings");
  }

  function deltaBadge(delta){
    if (!Number.isFinite(delta)) return "–";
    const cls = delta >= 0 ? "pos" : "neg";
    const sign = delta >= 0 ? "+" : "";
    return `<span class="${cls}">${sign}${fmt(delta)}</span>`;
  }

  function recalc(){
    const { gpNow, npNow } = computeNow();
    const fixes = totalSavings();
    const ors = num("orsRisk");
    const useFixes = document.getElementById("applyFixes").checked;
    const useORS = document.getElementById("applyORS").checked;

    document.getElementById("gpNowCell").textContent = fmt(gpNow);
    document.getElementById("npNowCell").textContent = fmt(npNow);

    const npFix = npNow + (useFixes ? fixes : 0);
    document.getElementById("gpFixCell").textContent = fmt(gpNow);
    document.getElementById("npFixCell").textContent = fmt(npFix);
    document.getElementById("npFixDelta").innerHTML = deltaBadge(npFix - npNow);

    const npORS = npNow + (useORS ? ors : 0);
    document.getElementById("gpORSCell").textContent = fmt(gpNow);
    document.getElementById("npORSCell").textContent = fmt(npORS);
    document.getElementById("npORSDelta").innerHTML = deltaBadge(npORS - npNow);

    const npBest = npNow + (useFixes ? fixes : 0) + (useORS ? ors : 0);
    document.getElementById("gpBestCell").textContent = fmt(gpNow);
    document.getElementById("npBestCell").textContent = fmt(npBest);
    document.getElementById("npBestDelta").innerHTML = deltaBadge(npBest - npNow);

    const period = (document.getElementById("periodLabel").value || "this period");
    document.getElementById("summary").textContent =
      `In ${period}, fixing inefficiencies adds ${fmt(useFixes ? fixes : 0)}, eliminating ORS adds ${fmt(useORS ? ors : 0)}. Best-case Net Profit becomes ${fmt(npBest)} (from ${fmt(npNow)}).`;
  }

  function copyJSON(){
    const payload = {
      period: document.getElementById("periodLabel").value || null,
      inputs: {
        revenue: num("revenue"), cogs: num("cogs"), opex: num("opex"),
        grossNow: num("grossNow") || null, netNow: num("netNow"),
      },
      savings: {
        payroll: num("payrollSavings"), churn: num("churnSavings"),
        workforce: num("workforceSavings"), deepDive: num("deepDiveSavings"),
        leadership: num("leadershipSavings"),
      },
      ors: { ebitdaAtRisk: num("orsRisk") },
      scenarios: {
        applyFixes: document.getElementById("applyFixes").checked,
        applyORS: document.getElementById("applyORS").checked
      },
      results: {
        now: { gross: gpNowCell.textContent, net: npNowCell.textContent },
        fixes: { gross: gpFixCell.textContent, net: npFixCell.textContent, delta: npFixDelta.innerText },
        orsOnly:{ gross: gpORSCell.textContent, net: npORSCell.textContent, delta: npORSDelta.innerText },
        best:   { gross: gpBestCell.textContent, net: npBestCell.textContent, delta: npBestDelta.innerText }
      }
    };
    const text = JSON.stringify(payload, null, 2);
    navigator.clipboard.writeText(text).then(
      () => alert("Copied results JSON to clipboard."),
      () => {
        const ta=document.createElement("textarea");
        ta.value=text; document.body.appendChild(ta); ta.select(); document.execCommand("copy");
        document.body.removeChild(ta); alert("Copied results JSON to clipboard.");
      }
    );
  }

  function clearPage(){
    const ids = ["revenue","cogs","opex","grossNow","netNow","periodLabel",
      "payrollSavings","churnSavings","workforceSavings","deepDiveSavings","leadershipSavings","orsRisk",
      "applyFixes","applyORS"];
    for (const id of ids){
      localStorage.removeItem(id);
      const el = document.getElementById(id);
      if (!el) continue;
      if (el.type === "checkbox") el.checked = (id==="applyFixes" || id==="applyORS");
      else el.value = "";
    }
    // reset the “user typed net profit” flag
    netNowTouched = false;
    recalc();
  }

  // ---------- INIT (works even when injected after DOMContentLoaded) ----------
  function boot(){
    // 1) Try snapshot (if ORS page saved it)
    const snap = readSnapshotFromLocal();
    if (snap) applySnapshotToInputs(snap);

    // 2) Usual preload of saved values and cross-module keys
    const ids = ["revenue","cogs","opex","grossNow","netNow","periodLabel",
      "payrollSavings","churnSavings","workforceSavings","deepDiveSavings","leadershipSavings","orsRisk",
      "applyFixes","applyORS"];
    for (const id of ids){
      const el = document.getElementById(id);
      if (!el) continue;
      const stored = localStorage.getItem(id);
      if (stored != null){
        if (el.type === "checkbox") el.checked = stored === "true";
        else if (!el.value) el.value = stored;
      }
      el.addEventListener(el.type === "checkbox" ? "change" : "input", () => {
        localStorage.setItem(id, el.type === "checkbox" ? String(el.checked) : el.value);
      });
    }

    // mark when the user edits Net Profit manually
    document.getElementById("netNow")?.addEventListener("input", () => { netNowTouched = true; });

    // 3) Backfill from other module keys if still empty
    if (!num("payrollSavings")){ const v = lsFirstNumber(KEYMAP.savings.payroll); if (v!=null) setVal("payrollSavings", v); }
    if (!num("churnSavings")){ const v = lsFirstNumber(KEYMAP.savings.churn); if (v!=null) setVal("churnSavings", v); }
    if (!num("workforceSavings")){ const v = lsFirstNumber(KEYMAP.savings.workforce); if (v!=null) setVal("workforceSavings", v); }
    if (!num("deepDiveSavings")){ const v = lsFirstNumber(KEYMAP.savings.deep); if (v!=null) setVal("deepDiveSavings", v); }
    if (!num("leadershipSavings")){ const v = lsFirstNumber(KEYMAP.savings.leadership); if (v!=null) setVal("leadershipSavings", v); }
    if (!num("orsRisk")){ const v = lsFirstNumber(KEYMAP.ors); if (v!=null) setVal("orsRisk", v); }

    // listeners + first calc
    ["revenue","cogs","opex","netNow","payrollSavings","churnSavings","workforceSavings","deepDiveSavings","leadershipSavings","orsRisk","applyFixes","applyORS","periodLabel"]
      .forEach(id => {
        const el=document.getElementById(id);
        if (!el) return;
        el.addEventListener(el.type==="checkbox"?"change":"input", recalc);
      });
    document.getElementById("recalc")?.addEventListener("click", recalc);
    document.getElementById("copyJSON")?.addEventListener("click", copyJSON);
    document.getElementById("clear")?.addEventListener("click", clearPage);

    recalc();
  }

  // Run immediately if DOM is already loaded (modules are injected after DOMContentLoaded)
  if (document.readyState === "loading") {
    window.addEventListener("DOMContentLoaded", boot);
  } else {
    boot();
  }
</script>
</body>
</html>
